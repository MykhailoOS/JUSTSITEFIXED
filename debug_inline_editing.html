<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥–∫–∞ –∏–Ω–ª–∞–π–Ω —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        
        .general_canva {
            border: 2px solid #007bff;
            padding: 20px;
            margin: 20px 0;
            min-height: 300px;
            background-color: #f8f9fa;
        }
        
        .el_text_block {
            margin: 10px 0;
            padding: 10px;
            border: 1px dashed #ccc;
            background-color: white;
        }
        
        .el_text {
            color: #333;
            font-size: 16px;
            cursor: text;
        }
        
        .el_button_block {
            margin: 10px 0;
            padding: 10px;
            border: 1px dashed #ccc;
            background-color: white;
        }
        
        .el_button {
            background-color: #007bff;
            color: white;
            padding: 8px 16px;
            text-decoration: none;
            border-radius: 4px;
            display: inline-block;
            cursor: pointer;
        }
        
        .el_link_block {
            margin: 10px 0;
            padding: 10px;
            border: 1px dashed #ccc;
            background-color: white;
        }
        
        .el_link {
            color: #007bff;
            text-decoration: underline;
            cursor: pointer;
        }
        
        .inline-editing {
            border: 2px solid #007bff !important;
            background-color: #e7f3ff !important;
            outline: none;
        }
        
        .edit-completed {
            background-color: #d4edda !important;
            transition: background-color 0.8s ease;
        }
        
        .debug-info {
            background-color: #f1f1f1;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üîß –û—Ç–ª–∞–¥–∫–∞ –∏–Ω–ª–∞–π–Ω —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h1>
    
    <div class="debug-info" id="debugLog">
        <strong>–õ–æ–≥ —Å–æ–±—ã—Ç–∏–π:</strong><br>
    </div>
    
    <p><strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong> –°–¥–µ–ª–∞–π—Ç–µ –¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –Ω–∞ –ª—é–±–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ –Ω–∏–∂–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥ —Å–æ–±—ã—Ç–∏–π –≤—ã—à–µ.</p>
    
    <div class="general_canva">
        <h3>üéØ –¢–µ—Å—Ç–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:</h3>
        
        <div class="el_text_block" data-id="1">
            <div class="el_text">–¢–µ–∫—Å—Ç –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫)</div>
        </div>
        
        <div class="el_button_block" data-id="2">
            <a href="#" class="el_button">–ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</a>
        </div>
        
        <div class="el_link_block" data-id="3">
            <a href="#" class="el_link">–°—Å—ã–ª–∫–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</a>
        </div>
        
        <div class="el_text_block" data-id="4">
            <div class="el_text">–í—Ç–æ—Ä–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç</div>
        </div>
    </div>
    
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function logEvent(message) {
            const debugLog = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            debugLog.innerHTML += `<br>[${timestamp}] ${message}`;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞
        function selectElementText(element) {
            logEvent('üìù –í—ã–±–∏—Ä–∞–µ–º —Ç–µ–∫—Å—Ç –≤ —ç–ª–µ–º–µ–Ω—Ç–µ');
            if (document.selection) {
                const range = document.body.createTextRange();
                range.moveToElementText(element);
                range.select();
            } else if (window.getSelection) {
                const range = document.createRange();
                range.selectNodeContents(element);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è startInlineEditing —Å –æ—Ç–ª–∞–¥–∫–æ–π
        function startInlineEditing($element) {
            logEvent(`üé¨ –ù–∞—á–∏–Ω–∞–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞: ${$element.get(0).tagName}.${$element.get(0).className}`);
            
            // Add editing class for visual feedback
            $element.addClass('inline-editing');
            logEvent('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∫–ª–∞—Å—Å inline-editing');
            
            // Store original content as text only
            const originalText = $element.text().trim();
            logEvent(`üìÑ –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç: "${originalText}"`);
            
            // Make element editable
            $element.attr('contenteditable', 'true');
            $element.focus();
            logEvent('‚úèÔ∏è –≠–ª–µ–º–µ–Ω—Ç —Å–¥–µ–ª–∞–Ω —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–º –∏ –ø–æ–ª—É—á–∏–ª —Ñ–æ–∫—É—Å');
            
            // Select all text for easy replacement
            selectElementText($element[0]);
            
            // Create finish editing function
            const finishEditing = function(e) {
                logEvent(`üîö –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –°–æ–±—ã—Ç–∏–µ: ${e ? e.type : '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}, –∫–ª–∞–≤–∏—à–∞: ${e && e.key ? e.key : '–Ω–µ—Ç'}`);
                
                // Only finish on blur or Enter key
                if (e && e.type === 'keydown' && e.key !== 'Enter') {
                    logEvent('‚è© –ü—Ä–æ–ø—É—Å–∫–∞–µ–º - –Ω–µ Enter –∏ –Ω–µ blur');
                    return;
                }
                if (e && e.type === 'keydown' && e.key === 'Enter') {
                    e.preventDefault();
                    logEvent('‚§µÔ∏è Enter –Ω–∞–∂–∞—Ç, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏');
                }
                
                // Remove editing state
                $element.removeClass('inline-editing');
                $element.removeAttr('contenteditable');
                $element.off('.inline-edit');
                logEvent('üßπ –£–±—Ä–∞–ª–∏ –∫–ª–∞—Å—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å–æ–±—ã—Ç–∏—è');
                
                // Get new text content and clean it
                const newText = $element.text().trim();
                logEvent(`üìù –ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç: "${newText}"`);
                
                // Only update if text actually changed
                if (newText !== originalText && newText !== '') {
                    $element.text(newText);
                    logEvent('üíæ –¢–µ–∫—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω (–∏–∑–º–µ–Ω–∏–ª—Å—è)');
                    
                    // Show completion feedback
                    $element.addClass('edit-completed');
                    setTimeout(() => {
                        $element.removeClass('edit-completed');
                        logEvent('‚ú® –£–±—Ä–∞–ª–∏ –ø–æ–¥—Å–≤–µ—Ç–∫—É –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è');
                    }, 800);
                } else if (newText === '') {
                    // Restore original text if empty
                    $element.text(originalText);
                    logEvent('üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç (–±—ã–ª –ø—É—Å—Ç—ã–º)');
                } else {
                    logEvent('‚û°Ô∏è –¢–µ–∫—Å—Ç –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è');
                }
            };
            
            // Bind finish editing events
            $element.on('blur.inline-edit keydown.inline-edit', finishEditing);
            logEvent('üéØ –ü—Ä–∏–≤—è–∑–∞–ª–∏ —Å–æ–±—ã—Ç–∏—è blur –∏ keydown');
            
            // Handle Escape key to cancel editing
            $element.on('keydown.inline-edit', function(e) {
                if (e.key === 'Escape') {
                    logEvent('‚ùå –ù–∞–∂–∞—Ç Escape - –æ—Ç–º–µ–Ω—è–µ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ');
                    $element.text(originalText);
                    $element.removeClass('inline-editing');
                    $element.removeAttr('contenteditable');
                    $element.off('.inline-edit');
                }
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
        $(document).ready(function() {
            logEvent('üöÄ DOM –≥–æ—Ç–æ–≤, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω–ª–∞–π–Ω —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...');
            
            const editableSelectors = [
                '.general_canva .el_text',
                '.general_canva .el_link',
                '.general_canva .el_button'
            ].join(', ');
            
            logEvent(`üéØ –°–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${editableSelectors}`);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            const foundElements = $(editableSelectors);
            logEvent(`üîç –ù–∞–π–¥–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ${foundElements.length}`);
            foundElements.each(function(index) {
                logEvent(`  ${index + 1}. ${this.tagName}.${this.className} - "${$(this).text().trim()}"`);
            });
            
            // Bind double click events
            $(document).off('dblclick.debug-inline-edit');
            $(document).on('dblclick.debug-inline-edit', editableSelectors, function(e) {
                logEvent(`üñ±Ô∏è –î–í–û–ô–ù–û–ô –ö–õ–ò–ö –æ–±–Ω–∞—Ä—É–∂–µ–Ω –Ω–∞: ${this.tagName}.${this.className}`);
                logEvent(`   –¢–µ–∫—Å—Ç —ç–ª–µ–º–µ–Ω—Ç–∞: "${$(this).text().trim()}"`);
                logEvent(`   Target: ${e.target.tagName}.${e.target.className}`);
                
                e.stopPropagation();
                const $element = $(this);
                
                // Skip if already editing
                if ($element.hasClass('inline-editing')) {
                    logEvent('‚è∏Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º - —É–∂–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç—Å—è');
                    return;
                }
                
                // Skip if element has no text content
                if (!$element.text().trim()) {
                    logEvent('‚è∏Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞–µ–º - –Ω–µ—Ç —Ç–µ–∫—Å—Ç–∞');
                    return;
                }
                
                startInlineEditing($element);
            });
            
            // –¢–∞–∫–∂–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–π –∫–ª–∏–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            $(document).on('click.debug', editableSelectors, function(e) {
                if (e.detail === 1) {
                    logEvent(`üñ±Ô∏è –û–¥–∏–Ω–∞—Ä–Ω—ã–π –∫–ª–∏–∫ –Ω–∞: ${this.tagName}.${this.className} (detail: ${e.detail})`);
                } else if (e.detail === 2) {
                    logEvent(`üñ±Ô∏è –í—Ç–æ—Ä–æ–π –∫–ª–∏–∫ –≤ –¥–≤–æ–π–Ω–æ–º –∫–ª–∏–∫–µ –Ω–∞: ${this.tagName}.${this.className} (detail: ${e.detail})`);
                }
            });
            
            logEvent('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω–ª–∞–π–Ω —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
        });
    </script>
</body>
</html>
